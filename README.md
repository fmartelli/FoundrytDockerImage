# Introduction
According to [Foundry official website](https://getfoundry.sh/introduction/overview), Foundry is a smart contract development toolchain.<br />
Foundry manages your dependencies, compiles your project, runs tests, deploys, and lets you interact with the chain from the command-line and via Solidity scripts.
Use this image to execute foundry commands and build solidity files with solc or projects with Foundry forge command.

# Build image
```
docker build . -t foundry
```

Set an alias for convenience
```
alias foundry='docker run --rm -it -v $(pwd)/work:/work -v $(pwd)/keystore:/root/.foundry/keystores foundry'
```

# Use it
## Create the sample Wallet
```
foundry cast wallet net
```

## Save the private key into a Keystore
```
foundry cast wallet import sample-wallet --private-key 0xcc5de0454f23ed6c48471eba2a3a3b956eb17d9224b6a9faa05ca5933a9c0c49
```

Keystore will be created into **keystore** folder given as volume. 

## Retrieve wallet address
```
foundry cast wallet address --account sample-wallet
```

## Solidity
Foundry includes the possibility to build the project's smart contracts by using **forge build** command.

Anyway, if you need to compile a single Solidity file you can use [solc-static-linux](https://github.com/argotorg/solidity) included by default into the image.
```
foundry solc ...
```

# Smart Contracts
Into the **work** folder is included a very simple smart contract: **Faucet**.
You can try to build the *Foundry.sol* file, retrieve its binary in hex format, create it on Sepolia Ethereum testnet, fund and call it.

In order to build the contract and obtain its binary in hex format you can run the following command.
```
foundry solc --bin /work/Faucet.sol
```

The given command will result into the following hex string.
```
6080604052348015600e575f5ffd5b506107e08061001c5f395ff3fe608060405260043610610041575f3560e01c8062f714ce14610044578063624d7b721461006c578063852aa16b146100a8578063a2724a4d146100d257610042565b5b005b34801561004f575f5ffd5b5061006a60048036038101906100659190610425565b6100fc565b005b348015610077575f5ffd5b50610092600480360381019061008d919061049e565b610370565b60405161009f91906104d8565b60405180910390f35b3480156100b3575f5ffd5b506100bc610384565b6040516100c991906104d8565b60405180910390f35b3480156100dd575f5ffd5b506100e661038e565b6040516100f391906104d8565b60405180910390f35b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461016a576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101619061054b565b60405180910390fd5b655af3107a40008211156101b3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101aa906105b3565b60405180910390fd5b610e105f5f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20546101fd91906105fe565b42101561023f576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102369061067b565b60405180910390fd5b81471015610282576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610279906106e3565b60405180910390fd5b425f5f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055505f8173ffffffffffffffffffffffffffffffffffffffff16836040516102e89061072e565b5f6040518083038185875af1925050503d805f8114610322576040519150601f19603f3d011682016040523d82523d5f602084013e610327565b606091505b505090508061036b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103629061078c565b60405180910390fd5b505050565b5f602052805f5260405f205f915090505481565b655af3107a400081565b610e1081565b5f5ffd5b5f819050919050565b6103aa81610398565b81146103b4575f5ffd5b50565b5f813590506103c5816103a1565b92915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6103f4826103cb565b9050919050565b610404816103ea565b811461040e575f5ffd5b50565b5f8135905061041f816103fb565b92915050565b5f5f6040838503121561043b5761043a610394565b5b5f610448858286016103b7565b925050602061045985828601610411565b9150509250929050565b5f61046d826103cb565b9050919050565b61047d81610463565b8114610487575f5ffd5b50565b5f8135905061049881610474565b92915050565b5f602082840312156104b3576104b2610394565b5b5f6104c08482850161048a565b91505092915050565b6104d281610398565b82525050565b5f6020820190506104eb5f8301846104c9565b92915050565b5f82825260208201905092915050565b7f4f6e6c7920746f2073656c6600000000000000000000000000000000000000005f82015250565b5f610535600c836104f1565b915061054082610501565b602082019050919050565b5f6020820190508181035f83015261056281610529565b9050919050565b7f546f6f206d7563680000000000000000000000000000000000000000000000005f82015250565b5f61059d6008836104f1565b91506105a882610569565b602082019050919050565b5f6020820190508181035f8301526105ca81610591565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61060882610398565b915061061383610398565b925082820190508082111561062b5761062a6105d1565b5b92915050565b7f436f6f6c646f776e0000000000000000000000000000000000000000000000005f82015250565b5f6106656008836104f1565b915061067082610631565b602082019050919050565b5f6020820190508181035f83015261069281610659565b9050919050565b7f456d7074790000000000000000000000000000000000000000000000000000005f82015250565b5f6106cd6005836104f1565b91506106d882610699565b602082019050919050565b5f6020820190508181035f8301526106fa816106c1565b9050919050565b5f81905092915050565b50565b5f6107195f83610701565b91506107248261070b565b5f82019050919050565b5f6107388261070e565b9150819050919050565b7f5472616e73666572206661696c656400000000000000000000000000000000005f82015250565b5f610776600f836104f1565b915061078182610742565b602082019050919050565b5f6020820190508181035f8301526107a38161076a565b905091905056fea264697066735822122020eddf9d51471211c937ab135e2cb781e8023bc2bb27b9adc170094b972ad07264736f6c63430008210033
```

By providing Foundry *send* command whith the contract above, you can deploy the contract on Ethereum blockchain.<br />
The following command permits to create the contract onto Sepolia Ethereum testnet.
```
foundry cast send --account sample-wallet --rpc-url https://ethereum-sepolia-rpc.publicnode.com --create \
6080604052348015600e575f5ffd5b506107e08061001c5f395ff3fe608060405260043610610041575f3560e01c8062f714ce14610044578063624d7b721461006c578063852aa16b146100a8578063a2724a4d146100d257610042565b5b005b34801561004f575f5ffd5b5061006a60048036038101906100659190610425565b6100fc565b005b348015610077575f5ffd5b50610092600480360381019061008d919061049e565b610370565b60405161009f91906104d8565b60405180910390f35b3480156100b3575f5ffd5b506100bc610384565b6040516100c991906104d8565b60405180910390f35b3480156100dd575f5ffd5b506100e661038e565b6040516100f391906104d8565b60405180910390f35b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461016a576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101619061054b565b60405180910390fd5b655af3107a40008211156101b3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101aa906105b3565b60405180910390fd5b610e105f5f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20546101fd91906105fe565b42101561023f576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102369061067b565b60405180910390fd5b81471015610282576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610279906106e3565b60405180910390fd5b425f5f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055505f8173ffffffffffffffffffffffffffffffffffffffff16836040516102e89061072e565b5f6040518083038185875af1925050503d805f8114610322576040519150601f19603f3d011682016040523d82523d5f602084013e610327565b606091505b505090508061036b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103629061078c565b60405180910390fd5b505050565b5f602052805f5260405f205f915090505481565b655af3107a400081565b610e1081565b5f5ffd5b5f819050919050565b6103aa81610398565b81146103b4575f5ffd5b50565b5f813590506103c5816103a1565b92915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6103f4826103cb565b9050919050565b610404816103ea565b811461040e575f5ffd5b50565b5f8135905061041f816103fb565b92915050565b5f5f6040838503121561043b5761043a610394565b5b5f610448858286016103b7565b925050602061045985828601610411565b9150509250929050565b5f61046d826103cb565b9050919050565b61047d81610463565b8114610487575f5ffd5b50565b5f8135905061049881610474565b92915050565b5f602082840312156104b3576104b2610394565b5b5f6104c08482850161048a565b91505092915050565b6104d281610398565b82525050565b5f6020820190506104eb5f8301846104c9565b92915050565b5f82825260208201905092915050565b7f4f6e6c7920746f2073656c6600000000000000000000000000000000000000005f82015250565b5f610535600c836104f1565b915061054082610501565b602082019050919050565b5f6020820190508181035f83015261056281610529565b9050919050565b7f546f6f206d7563680000000000000000000000000000000000000000000000005f82015250565b5f61059d6008836104f1565b91506105a882610569565b602082019050919050565b5f6020820190508181035f8301526105ca81610591565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61060882610398565b915061061383610398565b925082820190508082111561062b5761062a6105d1565b5b92915050565b7f436f6f6c646f776e0000000000000000000000000000000000000000000000005f82015250565b5f6106656008836104f1565b915061067082610631565b602082019050919050565b5f6020820190508181035f83015261069281610659565b9050919050565b7f456d7074790000000000000000000000000000000000000000000000000000005f82015250565b5f6106cd6005836104f1565b91506106d882610699565b602082019050919050565b5f6020820190508181035f8301526106fa816106c1565b9050919050565b5f81905092915050565b50565b5f6107195f83610701565b91506107248261070b565b5f82019050919050565b5f6107388261070e565b9150819050919050565b7f5472616e73666572206661696c656400000000000000000000000000000000005f82015250565b5f610776600f836104f1565b915061078182610742565b602082019050919050565b5f6020820190508181035f8301526107a38161076a565b905091905056fea264697066735822122020eddf9d51471211c937ab135e2cb781e8023bc2bb27b9adc170094b972ad07264736f6c63430008210033
```

In oder to retrieve the just created contract address, you can ask for the *receipt* by providing the returned **Transaction Hash** as input.
```
foundry cast receipt <trabsaction hash> --rpc-url https://ethereum-sepolia-rpc.publicnode.com
```

By referring to the contract providing its address, you can fund and use it.<br />
See below for the contract funding.
```
foundry cast send --account sample-wallet <contract address> --value 0.02ether --rpc-url https://ethereum-sepolia-rpc.publicnode.com
```

The given smart contract example (Faucet) provides a *withdraw* function.
```
function withdraw(uint256 amount, address payable to) external {
...
}
```

To call this function you have to send to the contract address a transaction with a payload which is a hex-serialized encoding of the following data.
1. The function ID (first 4 bytes of the Keccak-256 hash of the function prototype).
2. The function arguments (arguments encoded according to the rulesdefined in the specification.

The withdraw prototype function is
```
withdraw(uint256,address)
```

Just for completeness, the Keccak-256 hash of this prototype function can be regrieveb by the following command.
```
foundry cast keccak256 "withdraw(uint256,address)"
```

The fully completed paylod to be sent to the contract address to call the *withdraw* function, can be retrieved by using the following command.
```
foundry cast calldata "withdraw(uint256,address)" <amount in ether (e.g. 0.000001ether)> <payable addesss to (e.g. 0x8FaAc2110455e3A1F8b49EF97EAC7D2D47311241)> 
```

TYhe resulting paylod is something like as the following.
```
0x00f714ce000000000000000000000000000000000000000000000000000000e8d4a510000000000000000000000000008faac2110455e3a1f8b49ef97eac7d2d47311241
```

Use it to call *withdraw* function of de created and funded contract.
```
foundry cast send --account sample-wallet <contract address> \
0x00f714ce000000000000000000000000000000000000000000000000000000e8d4a510000000000000000000000000008faac2110455e3a1f8b49ef97eac7d2d47311241 \
--rpc-url https://ethereum-sepolia-rpc.publicnode.com
```
